version: '{build}'

branches:
  only:
    - master
    - build

image: Visual Studio 2015

install:
  - ps: $env:SUFFIX = $(git log -1 --format=%cd-%h --date=format:%y%m%d-%H%M%S $env:APPVEYOR_REPO_COMMIT)
  - ps: $env:RELEASE_NAME = "ci_test-"+$env:SUFFIX
  - ps: $env:OUTPUT_NAME = "ci_test-windows-"+$env:SUFFIX

build_script:
  - ps: env
  - ps: python ./build.py $env:OUTPUT_NAME

artifacts:
  - path: $(OUTPUT_NAME)
    name: output

deploy:
  release: $(RELEASE_NAME)
  description: 'ci_test'
  provider: GitHub
  auth_token:
    secure: sPHckOjYjTNtIT8ZUYl13F1K/G9deDsVQCWZ/yyHF99/l2N9O65wJBqMeDcilCA8
  artifact: output
  draft: false
  prerelease: false
  on:
    branch: build
